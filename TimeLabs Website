<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ratliff TimeLabs - Crew Timekeeping</title>
  <style>
    body {
      margin: 0;
      font-family: Calibri, sans-serif;
      background: linear-gradient(to bottom, #001f3f, #ffffff);
      color: white;
      display: flex;
      height: 100vh;
    }
    .sidebar {
      width: 250px;
      background: #001f3f;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: 20px;
      position: relative;
    }
    .nav-menu {
      display: flex;
      flex-direction: column;
      width: 100%;
      align-items: center;
      gap: 10px;
      margin-top: 60px;
    }
    .nav-menu a {
      width: 80%;
      padding: 10px;
      text-align: center;
      color: white;
      text-decoration: none;
      background: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .nav-menu a:hover {
      background: #003366;
    }
    .main-content {
      flex: 1;
      padding: 30px;
      overflow-y: auto;
    }
    .footer {
      text-align: center;
      padding: 10px;
      background: #001f3f;
      color: white;
      position: fixed;
      bottom: 0;
      width: 100%;
    }
    #weather-box {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      background-color: #001f3f;
      color: white;
      padding: 8px 10px;
      font-size: 13px;
      font-weight: bold;
      border-top-right-radius: 8px;
      z-index: 1000;
      text-align: center;
      box-sizing: border-box;
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <img src="Ratliff Logo.jpg" alt="Ratliff Electric Logo" style="max-width: 200px; margin-top: 10px;">
    <div class="nav-menu">
      <a href="javascript:void(0)" data-page="home">Dashboard</a>
      <a href="#" data-page="timesheet">Timesheet Management</a>
      <a href="#" data-page="tickets">Ticket Management</a>
      <a href="#" data-page="fileDownload">File Download</a>
      <a href="#" data-page="employees">Employees</a>
      <a href="#" data-page="reports">Reports</a>
      <a href="#" data-page="settings">Settings</a>
      <a href="#" data-page="admin">Admin</a>
    </div>
    <div id="weather-box">Loading Texas weather...</div>
  </div>
  <div class="main-content" id="main-content">
    <div style="display: flex; justify-content: center; align-items: center; height: 100%;">
      <h1 style="text-align: center;">Welcome to Ratliff TimeLabs</h1>
    </div>
  </div>
  <div class="footer">
    <marquee behavior="scroll" direction="left" scrollamount="5">1 Day Since The Last Accident</marquee>
    <span>Powered by Digital AI</span>
  </div>
  <script>
function showPage(page) {
  const main = document.getElementById('main-content');
  if (!main) return;

  if (page === 'home') {
    main.innerHTML = `<div style="display: flex; justify-content: center; align-items: center; height: 100%;">
      <h1 style="text-align: center;">Welcome to Ratliff TimeLabs</h1>
    </div>`;
  } else if (page === 'timesheet') {
    main.innerHTML = `
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
      <h2>Manage Timesheets</h2>
      <div>
        <button onclick="expandTimesheetForm()" style="margin-right: 10px; background-color: #28a745; color: white; padding: 8px 16px; font-size: 14px; border: none; border-radius: 8px; cursor: pointer;">Create Timesheet</button>
        <button style="background-color: #ffc107; color: black; padding: 8px 16px; font-size: 14px; border: none; border-radius: 8px; cursor: pointer;">Edit Timesheet</button>
      </div>
    </div>`;
    loadTimesheetTable();
  }
}

function expandTimesheetForm() {
  const main = document.getElementById('main-content');
  if (!main) return;
  main.innerHTML = `
    <div style="height: calc(100vh - 80px); padding: 20px;">
      <div style='display: flex; justify-content: space-between; align-items: center;'>
        <h2 style='color: black;'>Create Timesheet</h2>
        <div>
          <button onclick="expandTimesheetForm()" style="background-color: red; color: white; padding: 6px 14px; font-size: 14px; border: none; border-radius: 8px; cursor: pointer; margin-right: 10px;">Clear Form</button>
          <button onclick="saveTimesheet(event)" style="background-color: #007bff; color: white; padding: 6px 14px; font-size: 14px; border: none; border-radius: 8px; cursor: pointer;">Save</button>
        </div>
      </div>
      <iframe width="100%" height="600" frameborder="0" scrolling="no" src="May 5-May 11 Daily Time.xlsx"></iframe>
    </div>`;
}

function saveTimesheet(event) {
  event.preventDefault();
  const name = document.getElementById('ts-employee')?.value.trim();
  const hours = document.getElementById('ts-hours')?.value.trim();
  if (!name || !hours) return;

  fetch('https://your-backend-url.onrender.com/api/timesheets', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ employee: name, hours: parseInt(hours) })
  })
  .then(res => res.json())
  .then(() => {
    alert('Timesheet saved!');
    showPage('timesheet');
  })
  .catch(err => alert('Error saving timesheet: ' + err));
}

function loadTimesheetTable() {
  fetch('https://your-backend-url.onrender.com/api/timesheets')
    .then(res => res.json())
    .then(saved => {
      const container = document.createElement('div');
      container.innerHTML = `
        <h3 style="color: black; margin-top: 40px;">Saved Timesheets</h3>
        <table style="width: 100%; border-collapse: collapse; background: white; color: black; border: 1px solid #ccc;">
          <thead>
            <tr style="background-color: #003366; color: white;"><th>Employee</th><th>Total Hours</th></tr>
          </thead>
          <tbody>
            ${saved.map(entry => `<tr><td>${entry.employee}</td><td>${entry.hours}</td></tr>`).join('') || '<tr><td colspan="2">No timesheets saved.</td></tr>'}
          </tbody>
        </table>`;
      document.getElementById('main-content').appendChild(container);
    })
    .catch(err => console.error('Failed to load timesheets:', err));
}

document.addEventListener('DOMContentLoaded', function () {
  document.querySelectorAll('.nav-menu a').forEach(link => {
    link.addEventListener('click', function (e) {
      e.preventDefault();
      const page = this.getAttribute('data-page');
      showPage(page);
    });
  });

  const savedDays = localStorage.getItem('accidentDays');
  const savedDate = localStorage.getItem('accidentDate');
  if (savedDays && savedDate) {
    const ticker = document.querySelector('.footer marquee');
    const currentDate = new Date();
    const lastDate = new Date(savedDate);
    const diffDays = Math.floor((currentDate - lastDate) / (1000 * 60 * 60 * 24));
    const updatedDays = parseInt(savedDays) + diffDays;
    if (ticker) ticker.textContent = `${updatedDays} Day${updatedDays === 1 ? '' : 's'} Since The Last Accident`;
    localStorage.setItem('accidentDays', updatedDays);
    localStorage.setItem('accidentDate', currentDate.toISOString().split('T')[0]);
  }

  fetch('https://wttr.in/Texas?format=%C+%t')
    .then(response => response.text())
    .then(data => {
      const box = document.getElementById('weather-box');
      if (box) box.textContent = `Texas Weather: ${data}`;
    })
    .catch(() => {
      const box = document.getElementById('weather-box');
      if (box) box.textContent = 'Weather unavailable';
    });
});
</script>
</body>
</html>

